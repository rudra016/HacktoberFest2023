var PARTY_COOKIE_NAME="_dvp",PARTY_ID_TIMEOUT_SECONDS=63072E3,SESSION_COOKIE_NAME="_dvs",SESSION_SOURCE_NAME="_dvo",SESSION_ID_TIMEOUT_SECONDS=180,EVENT_TIMEOUT_SECONDS=1,COOKIE_DOMAIN="",LOGGING=!1,SCRIPT_NAME="cbpxl.js",EVENT_SUFFIX="dm-event",AUTO_PAGE_VIEW_EVENT=!0,KAFKA_JS_SERVER="https://pxl.charmboard.com/",hostName=window.location.hostname;
(function(e,g){g(e)})("undefined"!==typeof window?window:this,function(e){var g=e.document,t=e.navigator,f=e.console,v=function(a,b){return a.bind?a.bind(b):a},l=LOGGING&&f?v(f.log,f):function(){},u=LOGGING&&f?v(f.info,f):function(){},I=LOGGING&&f?v(f.warn,f):function(){},W=LOGGING&&f?v(f.error,f):function(){};l("Initializing Divolte.");f=function(){function a(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}
var b={localStorage:{get:function(){return localStorage.getItem("cb_visitorid")}},cookie:{get:function(){var b=g.cookie.match("(^|;) ?cb_visitorid=([^;]*)(;|$)");return b?b[2]:null}}}[/Version\/\d+\.\d+(\.\d+)?.*Safari/.test(t.userAgent)?"localStorage":"cookie"];return function(){var d=b.get();d||(d=a(),b.set(d));return d}}();try{var Q=f()}catch(a){Q=Math.floor(65536*(1+Math.random())).toString(16).substring(1)}f=function(){var a=function(b){var a="Divolte could not initialize itself";LOGGING&&(a+=
"; "+b);throw a+".";},b=g.currentScript,d;if("undefined"===typeof b){b=g.getElementsByTagName("script");for(var h=new RegExp("^(:?.*/)?"+SCRIPT_NAME.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"(:?[?#].*)?$"),c=b.length-1;0<=c;--c){var k=b.item(c).src;h.test(k)&&("undefined"===typeof d?d=k:a('multiple script elements found with src="\u2026/'+SCRIPT_NAME+'"'))}}else d=b.src;"undefined"===typeof d&&a('could not locate script with src=".../'+SCRIPT_NAME+'"');return d}();v=f.substr(0,1+f.lastIndexOf("/"));
u("Divolte base URL detected",v);var B=function(){return g.body||g.getElementsByTagName("body").item(0)},M=e.screen.availWidth,N=e.screen.availHeight,R=function(){return e.innerWidth||g.documentElement.clientWidth||B().clientWidth||g.documentElement.offsetWidth||B().offsetWidth},S=function(){return e.innerHeight||g.documentElement.clientHeight||B().clientHeight||g.documentElement.offsetHeight||B().offsetHeight},O=function(a){return g.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+a+"\\s*\\=\\s*([^;]*).*$)|^.*$"),
"$1")||null},P=function(a,b,d,h,c){a=a+"="+b+"; path=/; expires="+(new Date(h+1E3*d)).toUTCString()+"; max-age="+d;c&&(a+="; domain="+c);g.cookie=a},X=function(){var a=[0,10,20,5,15,16,1,11,21,6,7,17,2,12,22,23,8,18,3,13,14,24,9,19,4],b=[1,32898,32906,2147516416,32907,2147483649,2147516545,32777,138,136,2147516425,2147483658,2147516555,139,32905,32771,32770,128,32778,2147483658,2147516545,32896],d=[0,1,30,28,27,4,12,6,23,20,3,10,11,25,7,9,13,15,21,8,18,2,29,24,14];return function(h){var c,k=[];for(c=
0;25>c;c+=1)k[c]=0;if(15===h.length%16)h+="\u8001";else{for(h+="\u0001";15!==h.length%16;)h+="\x00";h+="\u8000"}for(var m=0;m<h.length;m+=16){for(c=0;16>c;c+=2)k[c/2]^=h.charCodeAt(m+c)+65536*h.charCodeAt(m+c+1);for(var e=0;22>e;e+=1){var f=[];for(c=0;5>c;c+=1)f[c]=k[c]^k[c+5]^k[c+10]^k[c+15]^k[c+20];var q=[];for(c=0;5>c;c+=1){var g=f[(c+1)%5];q[c]=f[(c+4)%5]^(g<<1|g>>>31)}f=[];for(c=0;25>c;c+=1){g=k[c]^q[c%5];var l=d[c];f[a[c]]=g<<l|g>>>32-l}for(c=0;5>c;c+=1)for(q=0;25>q;q+=5)k[q+c]=f[q+c]^~f[q+
(c+1)%5]&f[q+(c+2)%5];k[0]^=b[e]}}h=[];for(c=0;8>c;++c)m=k[c],h.push(m&255,m>>>8,m>>>16,m>>>24);return h}}(),Y=function(){var a=function(b,a){var d=a&65535;return((a-d)*b|0)+(d*b|0)|0};return function(b,d){for(var h=b.length,c="undefined"!==typeof d?d:0,f=h&-4,e,g=0;g<f;g+=4)e=b.charCodeAt(g)&255|(b.charCodeAt(g+1)&255)<<8|(b.charCodeAt(g+2)&255)<<16|(b.charCodeAt(g+3)&255)<<24,e=a(e,3432918353),e=(e&131071)<<15|e>>>17,e=a(e,461845907),c^=e,c=(c&524287)<<13|c>>>19,c=5*c+3864292196|0;e=0;switch(h%
4){case 3:e=(b.charCodeAt(f+2)&255)<<16;case 2:e|=(b.charCodeAt(f+1)&255)<<8;case 1:e|=b.charCodeAt(f)&255,e=a(e,3432918353),e=a((e&131071)<<15|e>>>17,461845907),c^=e}h^=c;h=a(h^h>>>16,2246822507);h=a(h^h>>>13,3266489909);return h^h>>>16}}(),E=function(){var a=Math,b=e.crypto||e.msCrypto,d="undefined"!==typeof b&&"undefined"!==typeof b.getRandomValues,h=d?function(a){a=new Uint8Array(a);b.getRandomValues(a);return a}:function(b){for(var d=Array(b),c=0;c<b;++c)d[c]=a.floor(256*a.random());return d},
c="application/pdf video/quicktime video/x-msvideo audio/x-pn-realaudio-plugin audio/mpeg3 application/googletalk application/x-mplayer2 application/x-director application/x-shockwave-flash application/x-java-vm application/x-googlegears application/x-silverlight".split(" "),f=["ShockwaveFlash.ShockwaveFlash.1","AcroPDF.PDF","AgControl.AgControl","QuickTime.QuickTime"],g=function(){var b=R(),a=S(),d=t.userAgent||"",h=t.platform||"",g=t.language||"",k=t.systemLanguage||"",l=t.userLanguage||"",m=M?
M.toString(36):"",p=N?N.toString(36):"",w=b?b.toString(36):"";b=a?b.toString(36):"";var n=t.mimeTypes;if(n){a="plugins:";for(var r=0,x=c.length;r<x;++r)a+=c[r]in n?"1":"0"}else a="";if("ActiveXObject"in e)for(n="activex:",r=0,x=f.length;r<x;++r){var u=f[r];try{var J=new ActiveXObject(u);n+="1";"getVersions"in J?n+="("+J.getVersions()+")":"getVariable"in J&&(n+="("+J.getVariable("$version")+")")}catch(ca){n+="0"}}else n="";return[d,h,g,k,l,m,p,w,b,a,n]},l=(new Date).getTime();return function(b){var a=
(new Date).getTime().toString(36);for(var c=e.location.href||"",f=h(32),k="",m=0;m<f.length;++m)k+=String.fromCharCode(f[m]);a=[a,c,k];d||a.push.apply(a,g());a=X(a.join(""));c="";f=0;for(k=a.length;f<k;++f)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxzy0123456789~_".charAt(a[f]&63);d||(c+="!");a=c;return"0:"+(b?l.toString(36)+":"+a:a)}}(),C,D,p=function(a){var b=a.indexOf("#");a=-1!==b?a.substring(b+1):null;if(null!==a&&-1!==a.indexOf("/"))throw"DVT not initialized correctly; page view ID may not contain a slash ('/').";
return a}(f),K,F,G=!!p;(function(){var a=O(PARTY_COOKIE_NAME),b=O(SESSION_COOKIE_NAME);(K=!a)?(l("New party; generating identifier."),C=E(!0)):C=a;(F=!b)?(l("New session; generating identifier."),D=E(!0)):D=b})();G&&l("Using server-provided pageview identifier.",p);u("Divolte party/session identifiers",C,D);var L=0,Z=function(){var a=L++;return p+a.toString(16)},T=function(a,b){var d=!1,h=setTimeout(function(){d||(d=!0,l("Timeout waiting for event callback; invoking anyway.",this,arguments),a.apply(this,
arguments))},b);return function(){d||(d=!0,clearTimeout(h),a.apply(this,arguments))}};f=function(){this.queue=[]};f.prototype.enqueue=function(a){var b=this.queue;l("Queueing item for processing; "+b.length+" currently pending.",a);b.push(a);1===b.length&&(l("No pending items; processing immediately.",a),this.processNextItem())};f.prototype.processNextItem=function(){var a=this.queue[0];switch(typeof a){case "string":this.deliverFirstPendingEvent(a);break;case "function":this.invokeFirstPendingCallback(a);
break;default:W("Dropping unknown type of item in signal queue.",a),this.onFirstPendingItemCompleted()}};f.prototype.deliverFirstPendingEvent=function(a){var b=this,d=new Image(1,1);l("Delivering pending event.",a);var h=T(function(){b.onFirstPendingItemCompleted()},100*EVENT_TIMEOUT_SECONDS);d.onload=h;d.src=KAFKA_JS_SERVER+EVENT_SUFFIX+"?"+a};f.prototype.invokeFirstPendingCallback=function(a){a();this.onFirstPendingItemCompleted()};f.prototype.onFirstPendingItemCompleted=function(){l("Marking pending item as complete.");
var a=this.queue;a.shift();a=a.length;0<a?(l("Processing next item; remaining count:",a),this.processNextItem()):l("All pending items have been delivered.")};var U=new f,aa=function(a){var b=[];for(d in a)a.hasOwnProperty(d)&&b.push(d);b.sort();var d="";for(var h=0;h<b.length;++h){var c=b[h],e=a[c];d+=c;d+="=";for(c=0;c<e.length;++c)d+=e[c],d+=",";d+=";"}a=unescape(encodeURIComponent(d));return Y(a)};(function(){var a=function(){this.buffer="";this.pendingFieldName=null};a.prototype.startObject=function(){this.addRecord("(")};
a.prototype.endObject=function(){this.pendingFieldName=null;this.addRecord(")")};a.prototype.startArray=function(){this.addRecord("a")};a.prototype.endArray=function(){this.addRecord(".")};a.prototype.setNextFieldName=function(b){this.pendingFieldName=b};a.prototype.addRecord=function(b,d){this.buffer+=b;null!==this.pendingFieldName&&(this.buffer+=a.escapeString(this.pendingFieldName),this.buffer+="!",this.pendingFieldName=null);d&&(this.buffer+=d)};a.escapeString=function(){var b=/[~!]/g;return function(a){return a.replace(b,
"~$&")}}();a.prototype.encodeString=function(b){this.addRecord("s",a.escapeString(b)+"!")};a.prototype.encodeNumber=function(b){if(isFinite(b)){var a=b===Math.floor(b)?b.toString(36):null,e=b.toExponential();b=String(b);null!==a&&a.length<=e.length&&a.length<=b.length?this.addRecord("d",a+"!"):this.addRecord("j",(e.length<b.length?e:b)+"!")}else this.encode(null,!1)};a.prototype.encodeBoolean=function(b){this.addRecord(b?"t":"f")};a.prototype.encodeNull=function(){this.addRecord("n")};a.prototype.encodeArray=
function(b){this.startArray();for(var a=0;a<b.length;++a)this.encode(b[a],!0);this.endArray()};a.prototype.encodeDate=function(){var b=function(b,a){for(var c=a.toString();c.length<b;)c="0"+c;return c};return function(a){a=isFinite(a.valueOf())?a.getUTCFullYear()+"-"+b(2,a.getUTCMonth()+1)+"-"+b(2,a.getUTCDate())+"T"+b(2,a.getUTCHours())+":"+b(2,a.getUTCMinutes())+":"+b(2,a.getUTCSeconds())+"."+b(3,a.getUTCMilliseconds())+"Z":null;this.encode(a,!1)}}();a.prototype.encodeJavaScriptObject=function(a){this.startObject();
for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(this.setNextFieldName(b),this.encode(a[b],!1));this.endObject()};a.prototype.encodeObject=function(a,d){if(null===a)this.encodeNull();else if("function"===typeof a.toJSON)this.encode(a.toJSON(),d);else switch(Object.prototype.toString.call(a)){case "[object Array]":this.encodeArray(a);break;case "[object Date]":this.encodeDate(a);break;default:this.encodeJavaScriptObject(a)}};a.prototype.encode=function(a,d){switch(typeof a){case "string":this.encodeString(a);
break;case "number":this.encodeNumber(a);break;case "boolean":this.encodeBoolean(a);break;case "object":this.encodeObject(a,d);break;case "undefined":d&&this.encode(null,!1);break;default:throw"Cannot encode of type: "+typeof a;}};a.mincode=function(b){var d=new a;d.encode(b,!1);b=d.buffer;return""!==b?b:void 0};return a.mincode})();var H=function(){G||(p=E(!1),y.pageViewId=p,L=0);u("Starting page view",p);AUTO_PAGE_VIEW_EVENT&&V("pageView")},V=function(a,b){null===p&&H();if(a){var d=Z();"undefined"===
typeof b?u("Signalling event: "+a,d):u("Signalling event: "+a,d,b);var f=O(SESSION_SOURCE_NAME),c=(new Date).getTime();F&&(f=g.referrer+(location.search?location.search:""),P(SESSION_SOURCE_NAME,f,SESSION_ID_TIMEOUT_SECONDS,c,COOKIE_DOMAIN));var k=g.referrer,l=C,t=D,v=p,q=d,y=K?"t":"f",z=F?"t":"f",A=e.location.href,B=e.devicePixelRatio,E=R(),G=S(),L=Q;try{var w=null!==localStorage.getItem("userObj")?JSON.stringify(localStorage.getItem("userObj")):"null"}catch(ba){w="null"}w={p:l,s:t,v:v,e:q,c:c,n:y,
f:z,l:A,r:k?k:void 0,i:M,j:N,k:B,w:E,h:G,t:a,g:L,d:w,o:f};var n="",r={};f=function(a,b){0<n.length&&(n+="&");var c=r[a];"undefined"===typeof c&&(c=[],r[a]=c);c.push(b);n+=a+"="+encodeURIComponent(b)};for(var x in w)if(w.hasOwnProperty(x))switch(k=w[x],typeof k){case "undefined":break;case "number":f(x,k);break;default:f(x,k)}"undefined"!==typeof b&&f("u",JSON.stringify(b));F=K=!1;P(SESSION_COOKIE_NAME,D,SESSION_ID_TIMEOUT_SECONDS,c,COOKIE_DOMAIN);P(PARTY_COOKIE_NAME,C,PARTY_ID_TIMEOUT_SECONDS,c,COOKIE_DOMAIN);
f("x",aa(r).toString(36));U.enqueue(n)}else I("Ignoring event with no type."),d=null;return d},y={partyId:C,sessionId:D,pageViewId:p,isNewPartyId:K,isFirstInSession:F,isServerPageView:G,signal:V,whenCommitted:function(a,b){u("Registering callback for when events have been flushed to server.");"undefined"!==typeof b&&(l("Callback will time out after "+b+"ms."),a=T(a,b));U.enqueue(a)}};if("object"!==typeof e.cbpxl){"function"===typeof e.define&&e.define.amd?e.define(function(){return y}):"undefined"!==
typeof e.module&&e.module.exports?e.module.exports=y:e.cbpxl=y;l("Module initialized.",y);if("undefined"!==typeof g.hidden){var z="hidden";var A="visibilitychange"}else"undefined"!==typeof g.mozHidden?(z="mozHidden",A="mozvisibilitychange"):"undefined"!==typeof g.msHidden?(z="msHidden",A="msvisibilitychange"):"undefined"!==typeof g.webkitHidden?(z="webkitHidden",A="webkitvisibilitychange"):I("Could not detect property for document visibility.");g[z]?g.addEventListener&&g.removeEventListener?(l("Page currently hidden; deferring start of page view."),
g.addEventListener(A,function b(){null===p&&!1===g[z]&&(l("Page became visible; starting deferred page view."),H());null!==p&&g.removeEventListener(A,b)})):(I("Page currently hidden, but don't know how to defer start of page view; starting page view immediately."),H()):(l("Page already visible; starting page view immediately."),H());"onpageshow"in e&&"onpagehide"in e&&e.addEventListener&&e.removeEventListener?(l("Detected Page Transition Event API; will trigger additional page-views during navigation."),
e.addEventListener("pagehide",function b(){e.removeEventListener("pagehide",b);e.addEventListener("pageshow",function(){l("Returning to page that is still loaded; starting a new page-view.");H()})})):(f=e.history)&&typeof("undefined"!==f.navigationMode)&&(u("Changing navigation mode from "+f.navigationMode+" to 'compatible'."),f.navigationMode="compatible")}else I("Divolte module already initialized; existing module left intact.");return y});